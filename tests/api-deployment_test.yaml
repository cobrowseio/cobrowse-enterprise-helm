suite: api deployment
templates:
  - templates/api-deployment.yaml
  - templates/api-secret.yaml
  - templates/api-configmap.yaml
tests:
  - it: deploys the api service
    template: templates/api-deployment.yaml
    asserts:
      - equal:
          path: spec.selector.matchLabels.component
          value: api
      - equal:
          path: spec.replicas
          value: 2

  - it: may run multiple replicas
    set:
      api.replicas: 3
    template: templates/api-deployment.yaml
    asserts:
      - equal:
          path: spec.replicas
          value: 3

  - it: runs a api container
    template: templates/api-deployment.yaml
    asserts:
      - isKind:
          of: Deployment
      - lengthEqual:
          path: spec.template.spec.containers
          count: 1
      - equal:
          path: spec.template.spec.containers[0].name
          value: api

  - it: may mount volumes containing certificate authorities
    template: templates/api-deployment.yaml
    asserts:
      - contains:
          any: true
          path: spec.template.spec.containers[0].volumeMounts
          content:
            name: mounted-config-map
            mountPath: "/var/run/cobrowse"
            readOnly: true

      - contains:
          any: true
          path: spec.template.spec.volumes
          content:
            name: mounted-config-map
            configMap:
              name: "RELEASE-NAME-volume-mounted-config-map"
              optional: true
